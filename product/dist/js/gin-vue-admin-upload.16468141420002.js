/*! 
 Build based on gin-vue-admin 
 Time : 1646814142000 */
var e=(e,a,l)=>new Promise(((t,i)=>{var n=e=>{try{o(l.next(e))}catch(a){i(a)}},s=e=>{try{o(l.throw(e))}catch(a){i(a)}},o=e=>e.done?t(e.value):Promise.resolve(e.value).then(n,s);o((l=l.apply(e,a)).next())}));import{g as a,d as l}from"./gin-vue-admin-fileUploadAndDownload.1646814142000.js";import{U as t,d as i}from"./gin-vue-admin-image.1646814142000.js";import{_ as n,u as s}from"../gva/gin-vue-admin-index.1646814142000.js";import{C as o}from"./gin-vue-admin-index.16468141420008.js";import{f as r}from"./gin-vue-admin-format.1646814142000.js";import{r as u,i as d,R as p,S as g,o as c,j as m,q as v,k as f,t as y,x as h,C as w,A as b,e as x,d as j}from"./gin-vue-admin-vendor.1646814142000.js";import"./gin-vue-admin-date.1646814142000.js";import"./gin-vue-admin-dictionary.1646814142000.js";import"./gin-vue-admin-sysDictionary.1646814142000.js";const _={class:"gva-table-box"},z={class:"gva-btn-list"},U=b("普通上传"),C=b("下载"),k=b("删除"),A={class:"gva-pagination"},S={name:"Upload"};var O=n(Object.assign(S,{setup(n){const S=u("/api"),O=s(),B=u(""),D=u(1),P=u(0),T=u(10),q=u([]),I=e=>{T.value=e,R()},K=e=>{D.value=e,R()},R=()=>e(this,null,(function*(){const e=yield a({page:D.value,pageSize:T.value});0===e.code&&(q.value=e.data.list,P.value=e.data.total,D.value=e.data.page,T.value=e.data.pageSize)}));R();const $=a=>e(this,null,(function*(){x.confirm("此操作将永久文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>e(this,null,(function*(){0===(yield l(a)).code&&(j({type:"success",message:"删除成功!"}),1===q.value.length&&D.value>1&&D.value--,R())})))).catch((()=>{j({type:"info",message:"已取消删除"})}))})),E=u(!1),F=e=>{E.value=!0;const a="image/jpeg"===e.type,l="image/png"===e.type,t=e.size/1024/1024<.5;return a||l||(j.error("上传图片只能是 jpg或png 格式!"),E.value=!1),t||(j.error("未压缩未见上传图片大小不能超过 500KB，请使用压缩上传"),E.value=!1),(l||a)&&t},G=e=>{E.value=!1,0===e.code?(j({type:"success",message:"上传成功"}),0===e.code&&R()):j({type:"warning",message:e.msg})},H=()=>{j({type:"error",message:"上传失败"}),E.value=!1};return(e,a)=>{const l=d("el-button"),n=d("el-upload"),s=d("el-table-column"),u=d("el-tag"),x=d("el-table"),j=d("el-pagination"),J=p("loading");return g((c(),m("div",null,[v("div",_,[v("div",z,[f(n,{action:`${S.value}/fileUploadAndDownload/upload`,"before-upload":F,headers:{"x-token":h(O).token},"on-error":H,"on-success":G,"show-file-list":!1,class:"upload-btn"},{default:y((()=>[f(l,{size:"mini",type:"primary"},{default:y((()=>[U])),_:1})])),_:1},8,["action","headers"]),f(t,{imageUrl:B.value,"onUpdate:imageUrl":a[0]||(a[0]=e=>B.value=e),"file-size":512,"max-w-h":1080,class:"upload-btn",onOnSuccess:R},null,8,["imageUrl"])]),f(x,{data:q.value},{default:y((()=>[f(s,{align:"left",label:"预览",width:"100"},{default:y((e=>[f(o,{"pic-type":"file","pic-src":e.row.url},null,8,["pic-src"])])),_:1}),f(s,{align:"left",label:"日期",prop:"UpdatedAt",width:"180"},{default:y((e=>[v("div",null,w(h(r)(e.row.UpdatedAt)),1)])),_:1}),f(s,{align:"left",label:"文件名",prop:"name",width:"180"}),f(s,{align:"left",label:"链接",prop:"url","min-width":"300"}),f(s,{align:"left",label:"标签",prop:"tag",width:"100"},{default:y((e=>[f(u,{type:"jpg"===e.row.tag?"primary":"success","disable-transitions":""},{default:y((()=>[b(w(e.row.tag),1)])),_:2},1032,["type"])])),_:1}),f(s,{align:"left",label:"操作",width:"160"},{default:y((e=>[f(l,{size:"small",icon:"download",type:"text",onClick:a=>{var l;(l=e.row).url.indexOf("http://")>-1||l.url.indexOf("https://")>-1?i(l.url,l.name):i(S.value+l.url,l.name)}},{default:y((()=>[C])),_:2},1032,["onClick"]),f(l,{size:"small",icon:"delete",type:"text",onClick:a=>$(e.row)},{default:y((()=>[k])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),v("div",A,[f(j,{"current-page":D.value,"page-size":T.value,"page-sizes":[10,30,50,100],style:{float:"right",padding:"20px"},total:P.value,layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:K,onSizeChange:I},null,8,["current-page","page-size","total"])])])])),[[J,E.value,void 0,{fullscreen:!0,lock:!0}]])}}}),[["__scopeId","data-v-280c722a"]]);export{O as default};

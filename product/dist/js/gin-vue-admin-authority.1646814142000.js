/*! 
 Build based on gin-vue-admin 
 Time : 1646814142000 */
var e=Object.defineProperty,a=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,u=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,i=(e,a,t)=>new Promise(((l,u)=>{var i=e=>{try{r(t.next(e))}catch(a){u(a)}},o=e=>{try{r(t.throw(e))}catch(a){u(a)}},r=e=>e.done?l(e.value):Promise.resolve(e.value).then(i,o);r((t=t.apply(e,a)).next())}));import{g as o,d as r,c as d,u as n,a as s}from"./gin-vue-admin-authority.16468141420002.js";import v from"./gin-vue-admin-menus.1646814142000.js";import y from"./gin-vue-admin-apis.1646814142000.js";import h from"./gin-vue-admin-datas.1646814142000.js";import{w as m}from"./gin-vue-admin-warningBar.1646814142000.js";import{r as c,i as p,o as f,j as g,k as I,q as b,t as w,H as _,v as k,A as C,e as N,d as x}from"./gin-vue-admin-vendor.1646814142000.js";import"../gva/gin-vue-admin-index.1646814142000.js";import"./gin-vue-admin-api.16468141420002.js";const V={class:"authority"},j={class:"gva-table-box"},z={class:"gva-btn-list"},A=C("新增角色"),O=C("设置权限"),P=C("新增子角色"),S=C("拷贝"),U=C("编辑"),q=C("删除"),B={class:"dialog-footer"},D=C("取 消"),E=C("确 定"),R={name:"Authority"},F=Object.assign(R,{setup(e){const C=c([{authorityId:"0",authorityName:"根角色"}]),R=c(!1),F=c("add"),T=c({}),H=c("新增角色"),$=c(!1),G=c(!1),J=c({}),K=c({authorityId:"",authorityName:"",parentId:"0"}),L=c({authorityId:[{required:!0,message:"请输入角色ID",trigger:"blur"},{validator:(e,a,t)=>/^[0-9]*[1-9][0-9]*$/.test(a)?t():t(new Error("请输入正整数")),trigger:"blur"}],authorityName:[{required:!0,message:"请输入角色名",trigger:"blur"}],parentId:[{required:!0,message:"请选择请求方式",trigger:"blur"}]}),M=c(1),Q=c(0),W=c(999),X=c([]),Y=c({}),Z=()=>i(this,null,(function*(){const e=yield o(((e,i)=>{for(var o in i||(i={}))t.call(i,o)&&u(e,o,i[o]);if(a)for(var o of a(i))l.call(i,o)&&u(e,o,i[o]);return e})({page:M.value,pageSize:W.value},Y.value));0===e.code&&(X.value=e.data.list,Q.value=e.data.total,M.value=e.data.page,W.value=e.data.pageSize)}));Z();const ee=(e,a)=>{T.value[e]=a},ae=c(null),te=c(null),le=c(null),ue=(e,a)=>{const t=[ae,te,le];a&&t[a].value.needConfirm&&(t[a].value.enterAndNext(),t[a].value.needConfirm=!1)},ie=e=>{N.confirm("此操作将永久删除该角色, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>i(this,null,(function*(){0===(yield r({authorityId:e.authorityId})).code&&(x({type:"success",message:"删除成功!"}),1===X.value.length&&M.value>1&&M.value--,Z())})))).catch((()=>{x({type:"info",message:"已取消删除"})}))},oe=c(null),re=()=>{oe.value&&oe.value.resetFields(),K.value={authorityId:"",authorityName:"",parentId:"0"}},de=()=>{re(),$.value=!1,G.value=!1},ne=()=>{if("0"===K.value.authorityId)return x({type:"error",message:"角色id不能为0"}),!1;oe.value.validate((e=>i(this,null,(function*(){if(e){switch(F.value){case"add":0===(yield s(K.value)).code&&(x({type:"success",message:"添加成功!"}),Z(),de());break;case"edit":0===(yield n(K.value)).code&&(x({type:"success",message:"添加成功!"}),Z(),de());break;case"copy":{const e={authority:{authorityId:"string",authorityName:"string",datauthorityId:[],parentId:"string"},oldAuthorityId:0};e.authority.authorityId=K.value.authorityId,e.authority.authorityName=K.value.authorityName,e.authority.parentId=K.value.parentId,e.authority.dataAuthorityId=J.value.dataAuthorityId,e.oldAuthorityId=J.value.authorityId;0===(yield d(e)).code&&(x({type:"success",message:"复制成功！"}),Z())}}re(),$.value=!1}}))))},se=()=>{C.value=[{authorityId:"0",authorityName:"根角色"}],ve(X.value,C.value,!1)},ve=(e,a,t)=>{K.value.authorityId=String(K.value.authorityId),e&&e.forEach((e=>{if(e.children&&e.children.length){const l={authorityId:e.authorityId,authorityName:e.authorityName,disabled:t||e.authorityId===K.value.authorityId,children:[]};ve(e.children,l.children,t||e.authorityId===K.value.authorityId),a.push(l)}else{const l={authorityId:e.authorityId,authorityName:e.authorityName,disabled:t||e.authorityId===K.value.authorityId};a.push(l)}}))},ye=e=>{re(),H.value="新增角色",F.value="add",K.value.parentId=e,se(),$.value=!0};return(e,a)=>{const t=p("el-button"),l=p("el-table-column"),u=p("el-table"),i=p("el-cascader"),o=p("el-form-item"),r=p("el-input"),d=p("el-form"),n=p("el-dialog"),s=p("el-tab-pane"),c=p("el-tabs"),N=p("el-drawer");return f(),g("div",V,[I(m,{title:"注：右上角头像下拉可切换角色"}),b("div",j,[b("div",z,[I(t,{size:"mini",type:"primary",icon:"plus",onClick:a[0]||(a[0]=e=>ye("0"))},{default:w((()=>[A])),_:1})]),I(u,{data:X.value,"tree-props":{children:"children",hasChildren:"hasChildren"},"row-key":"authorityId",style:{width:"100%"}},{default:w((()=>[I(l,{label:"角色ID","min-width":"180",prop:"authorityId"}),I(l,{align:"left",label:"角色名称","min-width":"180",prop:"authorityName"}),I(l,{align:"left",label:"操作",width:"460"},{default:w((e=>[I(t,{icon:"setting",size:"mini",type:"text",onClick:a=>{return t=e.row,R.value=!0,void(T.value=t);var t}},{default:w((()=>[O])),_:2},1032,["onClick"]),I(t,{icon:"plus",size:"mini",type:"text",onClick:a=>ye(e.row.authorityId)},{default:w((()=>[P])),_:2},1032,["onClick"]),I(t,{icon:"copy-document",size:"mini",type:"text",onClick:a=>(e=>{se(),H.value="拷贝角色",F.value="copy";for(const a in K.value)K.value[a]=e[a];J.value=e,$.value=!0})(e.row)},{default:w((()=>[S])),_:2},1032,["onClick"]),I(t,{icon:"edit",size:"mini",type:"text",onClick:a=>(e=>{se(),H.value="编辑角色",F.value="edit";for(const a in K.value)K.value[a]=e[a];se(),$.value=!0})(e.row)},{default:w((()=>[U])),_:2},1032,["onClick"]),I(t,{icon:"delete",size:"mini",type:"text",onClick:a=>ie(e.row)},{default:w((()=>[q])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])]),I(n,{modelValue:$.value,"onUpdate:modelValue":a[4]||(a[4]=e=>$.value=e),title:H.value},{footer:w((()=>[b("div",B,[I(t,{size:"small",onClick:de},{default:w((()=>[D])),_:1}),I(t,{size:"small",type:"primary",onClick:ne},{default:w((()=>[E])),_:1})])])),default:w((()=>[I(d,{ref_key:"authorityForm",ref:oe,model:K.value,rules:L.value,"label-width":"80px"},{default:w((()=>[I(o,{label:"父级角色",prop:"parentId"},{default:w((()=>[I(i,{modelValue:K.value.parentId,"onUpdate:modelValue":a[1]||(a[1]=e=>K.value.parentId=e),style:{width:"100%"},disabled:"add"==F.value,options:C.value,props:{checkStrictly:!0,label:"authorityName",value:"authorityId",disabled:"disabled",emitPath:!1},"show-all-levels":!1,filterable:""},null,8,["modelValue","disabled","options"])])),_:1}),I(o,{label:"角色ID",prop:"authorityId"},{default:w((()=>[I(r,{modelValue:K.value.authorityId,"onUpdate:modelValue":a[2]||(a[2]=e=>K.value.authorityId=e),disabled:"edit"==F.value,autocomplete:"off"},null,8,["modelValue","disabled"])])),_:1}),I(o,{label:"角色姓名",prop:"authorityName"},{default:w((()=>[I(r,{modelValue:K.value.authorityName,"onUpdate:modelValue":a[3]||(a[3]=e=>K.value.authorityName=e),autocomplete:"off"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),R.value?(f(),_(N,{key:0,modelValue:R.value,"onUpdate:modelValue":a[5]||(a[5]=e=>R.value=e),"with-header":!1,size:"40%",title:"角色配置"},{default:w((()=>[I(c,{"before-leave":ue,class:"role-box",type:"border-card"},{default:w((()=>[I(s,{label:"角色菜单"},{default:w((()=>[I(v,{ref_key:"menus",ref:ae,row:T.value,onChangeRow:ee},null,8,["row"])])),_:1}),I(s,{label:"角色api"},{default:w((()=>[I(y,{ref_key:"apis",ref:te,row:T.value,onChangeRow:ee},null,8,["row"])])),_:1}),I(s,{label:"资源权限"},{default:w((()=>[I(h,{ref_key:"datas",ref:le,authority:X.value,row:T.value,onChangeRow:ee},null,8,["authority","row"])])),_:1})])),_:1})])),_:1},8,["modelValue"])):k("",!0)])}}});export{F as default};

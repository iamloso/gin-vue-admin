/*! 
 Build based on gin-vue-admin 
 Time : 1646814142000 */
import{_ as e,u as t}from"../gva/gin-vue-admin-index.1646814142000.js";import{r as i,i as a,o as s,j as n,k as o,t as r,x as l,A as d,d as h}from"./gin-vue-admin-vendor.1646814142000.js";const c=(e,t)=>{var i=new Image;i.setAttribute("crossOrigin","anonymous"),i.onload=function(){var e=document.createElement("canvas");e.width=i.width,e.height=i.height,e.getContext("2d").drawImage(i,0,0,i.width,i.height);var a=e.toDataURL("image/png"),s=document.createElement("a"),n=new MouseEvent("click");s.download=t||"photo",s.href=a,s.dispatchEvent(n)},i.src=e};class u{constructor(e,t,i=1920){this.file=e,this.fileSize=t,this.maxWH=i}compress(){const e=this.file.type,t=this.file.size/1024;return new Promise((i=>{const a=new FileReader;a.readAsDataURL(this.file),a.onload=()=>{const s=document.createElement("canvas"),n=document.createElement("img");n.src=a.result,n.onload=()=>{const a=s.getContext("2d"),o=this.dWH(n.width,n.height,this.maxWH);s.width=o.width,s.height=o.height,a.clearRect(0,0,s.width,s.height),a.drawImage(n,0,0,s.width,s.height);const r=s.toDataURL(e,.9),l=this.fileSizeKB(r);l>this.fileSize&&console.log("图片尺寸太大!"+t+" >> "+l);const d=this.dataURLtoBlob(r,e),h=new File([d],this.file.name);i(h)}}}))}dWH(e,t,i){const a={width:e,height:t};return Math.max(e,t)>i?e>t?(a.width=i,a.height=Math.round(t*(i/e)),a):(a.height=i,a.width=Math.round(e*(i/t)),a):a}fileSizeKB(e){let t=0;return t=Math.round(3*e.split(",")[1].length/4/1024),t}dataURLtoBlob(e,t){const i=atob(e.split(",")[1]);let a=e.split(",")[0].split(":")[1].split(";")[0];const s=new ArrayBuffer(i.length),n=new Uint8Array(s);for(let o=0;o<i.length;o++)n[o]=i.charCodeAt(o);return t&&(a=t),new Blob([s],{type:a,lastModifiedDate:new Date})}}const m=d("点击上传"),g={name:"UploadImage",methods:{}};var p=e(Object.assign(g,{props:{imageUrl:{type:String,default:""},fileSize:{type:Number,default:2048},maxWH:{type:Number,default:1920}},emits:["on-success"],setup(e,{emit:d}){const c=e,g=i("/api"),p=t(),f=e=>{const t="image/jpeg"===e.type,i="image/png"===e.type;if(!t&&!i)return h.error("上传头像图片只能是 jpg或png 格式!"),!1;const a=e.size/1024<c.fileSize;if(!a){return new u(e,c.fileSize,c.maxWH).compress()}return a},w=e=>{const{data:t}=e;t.file&&d("on-success",t.file.url)};return(e,t)=>{const i=a("el-button"),d=a("el-upload");return s(),n("div",null,[o(d,{action:`${g.value}/fileUploadAndDownload/upload`,headers:{"x-token":l(p).token},"show-file-list":!1,"on-success":w,"before-upload":f,multiple:!1},{default:r((()=>[o(i,{size:"mini",type:"primary"},{default:r((()=>[m])),_:1})])),_:1},8,["action","headers"])])}}}),[["__scopeId","data-v-752d062a"]]);export{p as U,c as d};

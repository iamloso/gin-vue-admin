/*! 
 Build based on gin-vue-admin 
 Time : 1646814142000 */
var e=(e,a,t)=>new Promise(((o,s)=>{var r=e=>{try{i(t.next(e))}catch(a){s(a)}},n=e=>{try{i(t.throw(e))}catch(a){s(a)}},i=e=>e.done?o(e.value):Promise.resolve(e.value).then(r,n);i((t=t.apply(e,a)).next())}));import{e as a}from"./gin-vue-admin-api.16468141420002.js";import{s as t}from"../gva/gin-vue-admin-index.1646814142000.js";import{r as o,i as s,o as r,j as n,q as i,k as l,t as d,A as u,d as c}from"./gin-vue-admin-vendor.1646814142000.js";const p={class:"clearflex"},h=u("确 定"),v={name:"Apis"},y=Object.assign(v,{props:{row:{default:function(){return{}},type:Object}},setup(u,{expose:v}){const y=u,m=o({children:"children",label:"description"}),f=o([]),g=o([]),b=o("");(()=>{e(this,null,(function*(){const e=(yield a()).data.apis;f.value=I(e);const o=yield(s={authorityId:y.row.authorityId},t({url:"/casbin/getPolicyPathByAuthorityId",method:"post",data:s}));var s;b.value=y.row.authorityId,g.value=[],o.data.paths&&o.data.paths.forEach((e=>{g.value.push("p:"+e.path+"m:"+e.method)}))}))})();const k=o(!1),x=()=>{k.value=!0},I=e=>{const a={};e&&e.forEach((e=>{e.onlyId="p:"+e.path+"m:"+e.method,Object.prototype.hasOwnProperty.call(a,e.apiGroup)?a[e.apiGroup].push(e):Object.assign(a,{[e.apiGroup]:[e]})}));const t=[];for(const o in a){const e={ID:o,description:o+"组",children:a[o]};t.push(e)}return t},j=o(null),w=()=>e(this,null,(function*(){const e=j.value.getCheckedNodes(!0);var a=[];e&&e.forEach((e=>{var t={path:e.path,method:e.method};a.push(t)}));var o;0===(yield(o={authorityId:b.value,casbinInfos:a},t({url:"/casbin/updateCasbin",method:"post",data:o}))).code&&c({type:"success",message:"api设置成功"})}));return v({needConfirm:k,enterAndNext:()=>{w()}}),(e,a)=>{const t=s("el-button"),o=s("el-tree");return r(),n("div",null,[i("div",p,[l(t,{class:"fl-right",size:"mini",type:"primary",onClick:w},{default:d((()=>[h])),_:1})]),l(o,{ref_key:"apiTree",ref:j,data:f.value,"default-checked-keys":g.value,props:m.value,"default-expand-all":"","highlight-current":"","node-key":"onlyId","show-checkbox":"",onCheck:x},null,8,["data","default-checked-keys","props"])])}}});export{y as default};

/*! 
 Build based on gin-vue-admin 
 Time : 1646814142000 */
import{U as e,u as a,r as s,g as l,w as t,Q as n,i as u,o,j as r,k as i,t as v,J as m,K as c,H as p,q as d,M as y,x as g,A as f,C as h,V as S,S as b,W as q}from"./gin-vue-admin-vendor.1646814142000.js";import{u as I,e as x}from"../gva/gin-vue-admin-index.1646814142000.js";const N={class:"router-history"},C={name:"HistoryComponent"},J=Object.assign(C,{setup(C){const J=e(),O=a(),k=e=>e.name+JSON.stringify(e.query)+JSON.stringify(e.params),w=s([]),V=s(""),E=s(!1),j=I(),P=e=>e.name+JSON.stringify(e.query)+JSON.stringify(e.params),T=s(0),A=s(0),L=s(!1),H=s(!1),R=s(""),U=l((()=>j.userInfo.authority.defaultRouter)),_=()=>{w.value=[{name:U.value,meta:{title:"首页"},query:{},params:{}}],O.push({name:U.value}),E.value=!1,sessionStorage.setItem("historys",JSON.stringify(w.value))},K=()=>{let e;const a=w.value.findIndex((a=>(k(a)===R.value&&(e=a),k(a)===R.value))),s=w.value.findIndex((e=>k(e)===V.value));w.value.splice(0,a),a>s&&O.push(e),sessionStorage.setItem("historys",JSON.stringify(w.value))},M=()=>{let e;const a=w.value.findIndex((a=>(k(a)===R.value&&(e=a),k(a)===R.value))),s=w.value.findIndex((e=>k(e)===V.value));w.value.splice(a+1,w.value.length),a<s&&O.push(e),sessionStorage.setItem("historys",JSON.stringify(w.value))},Q=()=>{let e;w.value=w.value.filter((a=>(k(a)===R.value&&(e=a),k(a)===R.value))),O.push(e),sessionStorage.setItem("historys",JSON.stringify(w.value))},W=e=>{if(!w.value.some((a=>((e,a)=>{if(e.name!==a.name)return!1;for(const s in e.query)if(e.query[s]!==a.query[s])return!1;for(const s in e.params)if(e.params[s]!==a.params[s])return!1;return!0})(a,e)))){const a={};a.name=e.name,a.meta=e.meta,a.query=e.query,a.params=e.params,w.value.push(a)}window.sessionStorage.setItem("activeValue",k(e))},X=e=>{const a=e.instance.attrs.tab;O.push({name:a.name,query:a.query,params:a.params})},Y=e=>{const a=w.value.findIndex((a=>k(a)===e));k(J)===e&&(1===w.value.length?O.push({name:U.value}):a<w.value.length-1?O.push({name:w.value[a+1].name,query:w.value[a+1].query,params:w.value[a+1].params}):O.push({name:w.value[a-1].name,query:w.value[a-1].query,params:w.value[a-1].params})),w.value.splice(a,1)};t(E,(()=>{E.value?document.body.addEventListener("click",(()=>{E.value=!1})):document.body.removeEventListener("click",(()=>{E.value=!1}))})),t(J,((e,a)=>{"Login"!==e.name&&(w.value=w.value.filter((e=>!e.meta.closeTab)),W(e),sessionStorage.setItem("historys",JSON.stringify(w.value)),V.value=window.sessionStorage.getItem("activeValue"),a&&e&&a.name===e.name&&x.emit("reload"))}));return(()=>{x.on("closeThisPage",(()=>{Y(P(J))})),x.on("closeAllPage",(()=>{_()})),x.on("mobile",(e=>{H.value=e})),x.on("collapse",(e=>{L.value=e}));const e=[{name:U.value,meta:{title:"首页"},query:{},params:{}}];w.value=JSON.parse(sessionStorage.getItem("historys"))||e,window.sessionStorage.getItem("activeValue")?V.value=window.sessionStorage.getItem("activeValue"):V.value=k(J),W(J)})(),n((()=>{x.off("collapse"),x.off("mobile")})),(e,a)=>{const s=u("el-tab-pane"),l=u("el-tabs");return o(),r("div",N,[i(l,{modelValue:V.value,"onUpdate:modelValue":a[0]||(a[0]=e=>V.value=e),closable:!(1===w.value.length&&e.$route.name===g(U)),type:"card",onContextmenu:a[1]||(a[1]=S((e=>(e=>{if(1===w.value.length&&J.name===U.value)return!1;let a="";if(a="SPAN"===e.srcElement.nodeName?e.srcElement.offsetParent.id:e.srcElement.id,a){let s;E.value=!0,s=L.value?54:220,H.value&&(s=0),T.value=e.clientX-s,A.value=e.clientY+10,R.value=a.split("-")[1]}})(e)),["prevent"])),onTabClick:X,onTabRemove:Y},{default:v((()=>[(o(!0),r(m,null,c(w.value,(e=>(o(),p(s,{key:P(e),label:e.meta.title,name:P(e),tab:e,class:"gva-tab"},{label:v((()=>[d("span",{style:y({color:V.value===P(e)?g(j).activeColor:"#333"})},[d("i",{class:"dot",style:y({backgroundColor:V.value===P(e)?g(j).activeColor:"#ddd"})},null,4),f(" "+h(e.meta.title),1)],4)])),_:2},1032,["label","name","tab"])))),128))])),_:1},8,["modelValue","closable"]),b(d("ul",{style:y({left:T.value+"px",top:A.value+"px"}),class:"contextmenu"},[d("li",{onClick:_},"关闭所有"),d("li",{onClick:K},"关闭左侧"),d("li",{onClick:M},"关闭右侧"),d("li",{onClick:Q},"关闭其他")],4),[[q,E.value]])])}}});export{J as default};
